# [TDD] Ch3. TDD 좀 더 잘하기
> date - 2018.09.28  
> keyword - tdd  
> 테스트 주도 개발: 고품질 쾌속개발을 위한 TDD 실천번과 도구를 읽으며 공부했던 내용을 정리  
> test case 작성/접근 방식 등 TDD에 대한 내용 요약  

<br>

## 제품 코드와 테스트 코드를 함께 배포하기
* 일반적으로 분리해서 배포
* 모듈의 이식성 테스트시 함께 배포
  * JDK 버전, OS 등이 다른 경우

<br>

## test method 작성 방식

### 테스트 대상 메소드와 이름을 1:1로 일치
```java
// target
public int getBalance() {
    ...
}

// test case
@Test
public void testGetBalance() {
    ...
}
```
* 장점
  * 테스트 메소드의 숫자가 적어져서 보기 편하다
  * 대상 클래스의 메소드와 1:1로 연관지어 생각할 수 있다
* 단점
  * 테스트 메소드 내에 추가적인 test case가 존재할 경우 앞쪽에서 실패시 뒤쪽 case는 실행되지 않는다
* 특별히 추가 테스트가 필요 없는 `기본 동작 테스트`시 사용

### 테스트 대상 메소드의 이름 뒤에 추가적인 정보 기재
```java
// target
public void withdraw(int money) {
    ...
}

// test case
@Test
public void testWithdraw_마이너스통장인출() {
    ...
}

@Test
public void testWithdraw_잔고가0원일때() {
    ...
}
```
* 장점
  * 다양한 case별로 성공/실패를 알 수 있다
  * case별로 독립적으로 수행
* 단점
  * case별로 작성되기 때문에 메소드 숫자가 많아진다
  * case마다 리소스 초기화(setUp) 작업 필요
  * 이름 짓는 요령 필요
* 몇가지 조건절 테스트가 필요한 경우 사용

### 테스트 시나리오에 집중
* 특정 메소드를 대상으로 하기보다는 테스트 시나리오가 대상이 된다
```java
@Test
public void VIP고객이_인출할때_수수료계산() {
    ...
}

@Test
public void 일반고객이_인출할때_수수료계산() {
    ...
}
```

* integration test, acceptance test에 가까운 형태로 테스트 케이스를 만들 필요가 있을 때 사용
  * 클래스 자체의 통합적인 기능을 테스트할 때
* `선조건 -> 수행 -> 예상결과`의 시나리오에 기반하여 일정한 형식의 이름을 사용하면 좋다
```java
public class 환승테스트 {
    
    @Test
    public void 평일_30분이내에_환승_성공한다() {
        ...
    }

    @Test
    public void 평일_30분이후에_환승_실패한다() {
        ...
    }
}
```
* 장점
  * test case를 시나리오에 따라 체계적으로 작성할 수 있다
  * test class를 업무단위로 문서화할 수 있다
* 단점
  * 메소드 구현시 사용하기에는 무리
* `여러 메소드를 조합`해서 테스트가 필요한 비즈니스 로직 테스트에 사용

<br>

## 테스트 케이스 작성 접근 방식

### 설계자와 개발자가 분리되어 있는 경우
* 설계자가 설계문서에 `코드가 아닌 테스트 시나리오`로 테스트 케이스를 작성

### 개발자가 설계와 개발을 함께하는 경우
* 알고 있는 그대로 테스트 케이스를 작성
  * 개발자가 설계에 적극 참여해 제품에 주인의식을 갖고 스펙을 작성할 수 있는 경우
  * 사용자 스토리를 작성하고 스토리 카드 뒷면에 테스트 케이스 조건까지 적고 고객과 합의가 가능할 경우

```
[스토리 카드 앞면]
Backlog Item #34
09. 기능 공통 : 공통 : 첨부파일
  파일 업로드/다운로드 기능을 구현한다

스토리 포인트: 8
스프린트: #1

[스토리 카드 뒷면]
테스트 케이스
- hwp, doc, xls, ppt만 첨부 가능하다
- exe, bat, com 등의 확장자를 등록하려 할 때 보안 모듈을 호출한다
- 10M 이상의 파일은 업로드할 수 없다
```


### 무엇을 테스트 케이스로 작성할 것인가?
* `뭐가 됐든 테스트 케이스를 찾아내서 우선 개발 좀 하자`인 상황일 때 접근할 수 있는 방식

#### 1. 시나리오식 접근
* happy day scenario
  * 정상적인 흐름일 때 동작해야 하는 결과값을 선정
* blue day scenario
  * 발생할 수 있는 예외나 에러 상황에 대한 결과값을 선정

#### 2. 삼각측량법
* a * b == a + a +...

#### 3. Edge Case
* 경계조건 찾아내기
* 양수, 음수, 0, 아주 큰 값, 소수점 등


### test method 작성시 가이드 질문
* 결과가 옳은가?
* 모든 경계조건이 옳은가?
* 역관계를 확인할 수 있는가?
* 다른 수단을 사용해서 결과를 교차확인할 수 있는가?
* 에러 조건을 강제로 나타낼 수 있는가?
* 성능이 한도 내에 있는가?


<br>

## 기술적 관점에서 TDD의 한계

### 동시성 문제
* 상식적으로 `파악하기 어려운 불규칙한 문제가 발생`하기 때문에 테스트를 무결하게 유지하기 어렵다

### private, protected method
* 일반적인 방법으로 테스트 불가능
  * [PowerMock](https://github.com/powermock/powermock)으로 가능
* `public으로 되어 있는 메소드만 테스트해도 무방`
  * private method는 public method가 사용하기 때문에 public과 함께 test되기 때문
* public으로 테스트하고, 끝나면 private으로 만들고, `@Ignore` 지정

### GUI
* 심미적인 부분이 강하고, 사용자의 동작에 따라 화면이 많은 영향을 받기 때문에 단순히 `결과상태예상 -> 수행 -> 확인`순으로 테스트하기가 어렵거나 복잡해진다
* TDD를 적용하는 것보다 자동화된 테스트를 만드는 편이 더 낫다
* UI 영역에는 비즈니스 로직이 최대한 들어가지 않게 작성

### 의존성 모듈 테스트
* target = A but A -> B
* 테스트하려는 부분에 `의존성이 있는 모듈을 사용`하고, 의존성 모듈에 대한 접근이 쉽지 않을 경우
  * 의존성 모듈을 둘러싼 proxy class를 만들어 온전히 B부터 테스트
  * B를 신뢰하는 가정하에 A만을 테스트
  * Mock 객체 사용

<br>

> TDD를 적용하면 품질이 아주 높아집니다. 시간지연을 상쇄하고도 남을 만큼 말이죠!

---

<br>

> #### Reference
> * [3장 - TDD 좀 더 잘하기](https://repo.yona.io/doortts/blog/issue/4)
