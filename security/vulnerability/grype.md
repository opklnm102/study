# [Security] grype - A vulnerability scanner for container images and filesystems
> date - 2022.06.09  
> keyworkd - security, cve, vulnerability, vulnerability scanner  
> 취약점 스캐너 grype에 대해 정리  

<br>

## What is grype?
* container image와 filesystem을 위한 vulnerability scanner
* SBOM(software bill of materials) tool인 [Syft](https://github.com/anchore/syft)와 함꼐 동작
* CI/CD pipeline에 포함시켜 code commit시 새로운 취약점을 알려준다


<br>

## Installation
* Recommended
```sh
$ curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin
```

* Homebrew
```sh
$ brew tap anchore/grype
$ brew install grype
```

* Container image
```sh
## .zshrc
alias grype="docker run -it --rm anchore/grype"
```


<br>

## Usage

### Scan image
```sh
$ grype [image]

## example
$ grype bitnami/kubectl
 ✔ Vulnerability DB        [updated]
 ✔ Parsed image
 ✔ Cataloged packages      [123 packages]
 ✔ Scanned image           [136 vulnerabilities]
NAME               INSTALLED              FIXED-IN     TYPE  VULNERABILITY     SEVERITY
apt                2.2.4                               deb   CVE-2011-3374     Negligible
bsdutils           1:2.36.1-8+deb11u1                  deb   CVE-2022-0563     Negligible
coreutils          8.32-4+b1                           deb   CVE-2017-18018    Negligible
...
```

<br>

### Scan image archive
```sh
$ grype path/to/image.tar
```

<br>

### Scan filesystem
```sh
$ grype dir:path/to/dir
```

<br>

### CI with Github Action
```yaml
name: Container Image CI
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the container image
        run: docker build . --file Dockerfile --tag localbuild/testimage:latest
      - uses: anchore/scan-action@v3
        id: scan
        with:
          image: "localbuild/testimage:latest"
          fail-build: true
          acs-report-enable: true
      - name: upload Anchore scan SARIF report
        uses: github/codeql-action/upload-sarif@v1
        with:
          sarif_file: ${{ steps.scan.outputs.sarif }}
      - name: Inspect action SARIF report
        run: cat ${{ steps.scan.outputs.sarif }}
```


<br><br>

> #### Reference
> * [anchore/grype - A vulnerability scanner for container images and filesystems](https://github.com/anchore/grype)
> * [Anchore Container Scan - GitHub Action for Vulnerability Scanning](https://github.com/marketplace/actions/anchore-container-scan)
