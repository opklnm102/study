# Docker 기초

## [컨테이너란?](https://www.docker.com/what-container)
가상화보다 훨씬 가벼운 기술

![Container](https://www.docker.com/sites/default/files/Container%402x.png)
Container - 격라

![Virtual Machines](https://www.docker.com/sites/default/files/VM%402x.png)
VM - 가상화

![Containers and Virtual Machines Togeter](https://www.docker.com/sites/default/files/containers-vms-together.png)
Containers and Virtual Machines Togeter

### 1. 서버의 성능이 좋아졌다 
* 서버가 놀고 있다
* 서버에 VM을 여러개 띄워서 일을 더 시키자

### 2. IT 기술이 보편화되면서 서버도 많아짐
* 서버자체를 VM에 집어넣어서 돌리자
* VM에 각종 서버 프로그램, DB등을 설치하여 App을 실행
* 미리 구축한 VM 이미지를 여러 서버에 복사하여 실행하면 이미지 하나로 서버를 계속 만들어 낼 수 있음
* 가상화 기술을 이용하여 서버를 임대해주는 서비스가 클라우드 서비스

### 3. 근데 가상머신은 문제가 있어
* 컴퓨터를 통째로 만들어내다 보니 각종 성능 손실이 발생
* 인텔, AMD는 CPU안에 가상화 기능을 넣기 시작
* 그래도 느림

* 호스트와 커널을 공유하는 반가상화 기술 등장
### 4. 이러나 저러나 VM은 완전한 컴퓨터
* 항상 게스트 OS를 설치해야함  
* 이미지안에 OS가 포함
   * 이미지 용량이 커짐 
   * 네트워크로 가상화 이미지를 주고받는건 꽤 부담스러움

### 5. 오픈소스 가상화SW는 OS가상화에만 주력
* 배포와 관리 기능이 부족

### 6. VM의 성능문제가 있다보니 리눅스 컨테이너가 나옴
* 컨테이너 안에 가상공간을 만들지만 실행파일을 호스트에서 직접 실행
* 리눅스 커널의 cgroups, namespaces가 제공하는 기술
* 가상화가 아닌 `격리`!!


## 도커의 특징
### 1. 게스트 OS를 설치하지 않음 
* 이미지에 서버운영을 위한 프로그램과 라이브러리만 `격리해서 설치`
* 이미지 용량이 크게 줄어듦
* 호스트와 OS자원(system call)을 공유
* 리눅스 커널에서 제공하는 `컨테이너 기술 이용`

### 2. HW가상화 계층이 없음
* 메모리 접근, 파일 시스템, 네트워크 전송속도가 VM에 비해 월등히 빠름
* 호스트와 도커 컨테이너 사이의 성능차이가 크지 않음(오차범위 안)

### 3. 이미지 생성과 배포에 특화
* 이미지 버전관리도 제공하고 중앙저장소에 이미지를 올리고 받을 수 있음(Push/Pull)
* 이미지를 공유하는 Docker hub 제공
   * GitHub와 비슷한 방식

### 4. 다양한 API를 제공하여 원하는 만큼 자동화 가능
* 개발과 서버 운영에 매우 유용
* 개발, 테스트, 서비스 환경을 하나로 통일하여 효율적으로 관리
* 복잡한 리눅스 애플리케이션을 컨테이너로 묶어서 실행


## 도커 이미지와 컨테이너의 차이?
* 이미지
   * 서비스 운영에 필요한 `서버 프로그램, 소스코드, 컴파일된 실행파일을 묶은 형태`
   * 저장소에 올리고 받는건(push/pull) 이미지
   * OS로 치면 `실행파일`
* 컨테이너
   * `이미지를 실행`한 상태
   * 이미지로 `여러개의 컨테이너를 만들 수` 있음
   * OS로 치면 `프로세스`

> #### 도커의 이미지 처리방식, 도커는 이미지의 바뀐 부분을 어떻게 관리하나?
> * 유니온 파일 시스템 형식(aufs, btrfs, devicemapper)
> * 베이스 이미지에서 바뀐부분만 이미지로 생성
> * 컨테이너로 실행할 때는 베이스 이미지와 바뀐 부분을 합쳐서 실행
> * Docker Hub 및 개인저장소에서 이미지를 공유할 때 바뀐 부분만 주고 받음
>    *각 이미지는 의존관계 형성

## 서비스 운영과 도커
* 지금까지는 물리서버를 직접 운영
   * 호스팅 또는 IDC 코로케이션 서비스 사용
   * 서버구입과 설치에 돈이 많이들고 시간이 오래걸림
* 가상화가 발전하면서 클라우드 환경으로 변화
   * 가상서버를 임대하여 사용한 만큼만 요금지불
   * 클릭 몇번만으로 가상서버를 생성 - 자동으로 서버를 추가, 삭제
   * 서버 대수가 많아지면서 사람이 일일이 세팅하기 힘들어짐
      * Immutable Infrastructure라는 패러다임 등장

### Immutable Infrastructure
* 호스트 OS와 서비스 운영환경(서버 프로그램, 소스코드, 컴파일된 바이너리)을 분리
* 1번 설정한 운영환경은 변경하지 않는다(Immutable)는 개념
* 서비스 운영환경을 이미지로 생성한 뒤 서버에 배포하여 실행 
* 서비스가 업데이트되면 운영환경 자체를 변경하지 않고, 이미지를 새로 생성하여 배포
* 클라우드 플랫폼에서 서버를 쓰고 버리는 것과 같이 Immutable Infrastructure도 서비스 운영환경 이미지를 1번쓰고 버림

#### Immutable Infrastructure 장점

##### 1. 편리한 관리
* 서비스 환경 이미지만 관리하면 됨
* 중앙 관리를 통한 체계적인 배포와 관리
* 이미지 생성에 버전관리 시스템 활용

##### 2. 확장
* 이미지 하나로 서버를 계속 찍어낼 수 있음
* 클라우드 플랫폼의 Auto Scaling기능과 연동하여 손쉽게 서비스를 확장

##### 3. 테스트
* 개발자 PC, 테스트 서버에서 이미지를 실행만 하면 서비스 운영환경과 동일한 환경이 구성됨
* 테스트가 간편

##### 4. 가볍다
* OS와 서비스 환경을 분리하여 가볍고(Lightweight) 어디서든 실행가능한(Portable) 환경 제공


> #### 침고
> [도커 무작정 따라하기: 도커가 처음인 사람도 60분이면 웹 서버를 올릴 수 있습니다!](https://www.slideshare.net/pyrasis/docker-fordummies-44424016)  
>  [What is a Container](https://www.docker.com/what-container)  
